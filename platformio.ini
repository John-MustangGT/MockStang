; ============================================
; Common settings for all environments
; ============================================
[env]
framework = arduino
monitor_speed = 115200
build_flags =
    -DCORE_DEBUG_LEVEL=0
    -DMOCKSTANG_VERSION=\"1.0.0\"

; ============================================
; ESP-01/ESP-01S (WiFi only, minimal)
; ============================================
[env:esp01]
platform = espressif8266
board = esp01_1m

; ESP-01S has 1MB flash
board_build.flash_mode = dout
board_build.ldscript = eagle.flash.1m256.ld

; Optimize for size
build_flags =
    ${env.build_flags}
    -Os
    -DVTABLES_IN_FLASH
    -ffunction-sections
    -fdata-sections
    -Wl,--gc-sections
    -DPIO_FRAMEWORK_ARDUINO_LWIP2_LOW_MEMORY
    -DESP01_BUILD
    -DWIFI_ONLY

; Upload settings for ESP-01S
upload_speed = 57600
upload_resetmethod = nodemcu

; Upload flags for ESP-01 compatibility
upload_flags =
    --before=default_reset
    --after=hard_reset

; Dependencies - WiFi only
lib_deps =
    https://github.com/me-no-dev/ESPAsyncTCP.git
    https://github.com/me-no-dev/ESPAsyncWebServer.git

; ============================================
; ESP32-S3 Feather (WiFi + BLE + Display)
; ============================================
[env:esp32s3]
platform = espressif32
board = adafruit_feather_esp32s3_tft
board_build.mcu = esp32s3
board_build.f_cpu = 240000000L

; Enable PSRAM
board_build.arduino.memory_type = qio_opi
board_build.flash_mode = qio
board_build.psram_type = opi

; Optimize for performance
build_flags =
    ${env.build_flags}
    -O2
    -DESP32_BUILD
    -DWIFI_AND_BLE
    -DHAS_DISPLAY
    -DBOARD_HAS_PSRAM
    -DARDUINO_USB_CDC_ON_BOOT=1
    !echo "-DGIT_COMMIT_HASH=\\\"$(git rev-parse --short HEAD)\\\""
    !echo "-DBUILD_TIMESTAMP=\\\"$(date +%%Y%%m%%d_%%H%%M%%S)\\\""

; Upload settings
upload_speed = 921600

; Dependencies - Full featured
lib_deps =
    https://github.com/me-no-dev/AsyncTCP.git
    https://github.com/me-no-dev/ESPAsyncWebServer.git
    h2zero/NimBLE-Arduino@^1.4.1
    adafruit/Adafruit GFX Library@^1.11.9
    adafruit/Adafruit ST7735 and ST7789 Library@^1.10.3

; ============================================
; ESP32-S3 BLE Sniffer (Client mode for debugging real Vgate adapter)
; ============================================
[env:esp32s3_sniffer]
platform = espressif32
board = adafruit_feather_esp32s3_tft
board_build.mcu = esp32s3
board_build.f_cpu = 240000000L

; Enable PSRAM
board_build.arduino.memory_type = qio_opi
board_build.flash_mode = qio
board_build.psram_type = opi

build_flags =
    ${env.build_flags}
    -O2
    -DESP32_BUILD
    -DBLE_SNIFFER_MODE
    -DBOARD_HAS_PSRAM
    -DARDUINO_USB_CDC_ON_BOOT=1

; Upload settings
upload_speed = 921600

; Dependencies - BLE only for sniffer
lib_deps =
    h2zero/NimBLE-Arduino@^1.4.1

; Use sniffer source file
build_src_filter = +<ble_sniffer.cpp> -<mockstang.ino>

